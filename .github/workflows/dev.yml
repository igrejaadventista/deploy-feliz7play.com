on:
    push:
      branches: [dev]
    workflow_dispatch:

name: Deploy website - DEV
jobs:
  web-deploy:
    name: ðŸŽ‰ Deploy
    runs-on: ubuntu-latest
    environment: dev
    steps:
    - name: ðŸšš Get latest code
      uses: actions/checkout@v4

    - name: Transform wp-config.php
      run: |
        echo "Init transform: wp-config.php"
        sed -i 's/WP_DB_NAME/${{ secrets.WP_DB_NAME }}/' ./app/wp-config.php
        sed -i 's/WP_DB_USER/${{ secrets.WP_DB_USER }}/' ./app/wp-config.php
        sed -i 's/WP_DB_PASSWORD/${{ secrets.WP_DB_PASSWORD }}/' ./app/wp-config.php
        sed -i 's/WP_DB_HOST/${{ secrets.WP_DB_HOST }}/' ./app/wp-config.php
        sed -i 's/WP_S3_ACCESS_KEY/${{ secrets.WP_S3_ACCESS_KEY }}/' ./app/wp-config.php
        sed -i 's/WP_S3_SECRET_KEY/${{ secrets.WP_S3_SECRET_KEY }}/' ./app/wp-config.php
        sed -i 's/WP_S3_BUCKET/${{ secrets.WP_S3_BUCKET }}/' ./app/wp-config.php
        echo "End transform: wp-config.php"
    
    - name: ðŸ“‚ Sync files SFTP
      uses: wlixcc/SFTP-Deploy-Action@v1.2.4
      with:
        username: ${{ secrets.FTP_USER }}
        server: ${{ secrets.FTP_HOST }}
        port: 65002
        local_path: './app/*'
        remote_path: '/home/${{ secrets.FTP_USER }}/domains/dev-f7p.internetdsa.com/public_html/'
        sftp_only: true
        password: ${{ secrets.FTP_PWD }}